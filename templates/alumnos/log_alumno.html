{% extends "layout/base.html" %}

{% block titulo %}Generar log del alumno{% endblock %}

{% block contenido %}
<style>
  .btn-regresar {
    display: inline-block;
    margin-left: 1rem;
    padding: 0.5rem 1rem;
    background-color: #555;
    color: #fff;
    text-decoration: none;
    border-radius: 4px;
    font-weight: bold;
    transition: background-color 0.3s ease;
  }
  .btn-regresar:hover { background-color: #333; }

  .form-actions {
    margin-top: 1.5rem;
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .formulario-alumno fieldset {
    border: 1px solid #ccc;
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 6px;
  }
  .formulario-alumno label { display: block; margin-top: 0.8rem; font-weight: bold; }
  .formulario-alumno select {
    width: 100%;
    padding: 0.4rem;
    margin-top: 0.2rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    background-color: #f9f9f9;
  }

  .alerta-exito {
    background-color: #d4edda;
    color: #155724;
    padding: 0.8rem;
    border-radius: 4px;
    margin-bottom: 1rem;
  }
  .alerta-error {
    background-color: #f8d7da;
    color: #721c24;
    padding: 0.8rem;
    border-radius: 4px;
    margin-bottom: 1rem;
  }
</style>

<main class="dashboard-main">
  <div class="dashboard-body">
    <h2>Generar log del alumno</h2>

    {% if mensaje %}
      <div class="alerta-exito">{{ mensaje }}</div>
    {% endif %}
    {% if error %}
      <div class="alerta-error">{{ error }}</div>
    {% endif %}

    <form method="POST" action="/alumnos/log" class="formulario-alumno">
      <fieldset>
        <legend>Buscar alumno</legend>
        <label for="alumno">Selecciona un alumno:</label>
        <select name="alumno" id="alumno" required>
          <option value="">-- Selecciona --</option>
          {% for alumno in alumnos %}
            <option value="{{ alumno.matricula }}">{{ alumno.nombre }}</option>
          {% endfor %}
        </select>
      </fieldset>

      <div class="form-actions">
        <button type="submit">Generar log</button>
        <a href="/dashboard" class="btn-regresar">Regresar</a>
      </div>
    </form>

    {% if resumen.datos %}
      <hr>
      <h3>Resumen del alumno</h3>
      <p><strong>Nombre:</strong> {{ resumen.datos.nombre }} {{ resumen.datos.apellido_paterno }} {{ resumen.datos.apellido_materno }}</p>
      <p><strong>Matrícula:</strong> {{ resumen.datos.matricula }}</p>
      <p><strong>Correo:</strong> {{ resumen.datos.correo }}</p>
      <p><strong>Teléfono:</strong> {{ resumen.datos.telefono }}</p>
      <p><strong>Estado:</strong> {{ resumen.datos.estado }}</p>
      <p><strong>Activo:</strong> {{ resumen.datos.activo }}</p>
      <p><strong>Fecha de registro:</strong> {{ resumen.datos.fecha_registro }}</p>

      {% if resumen.proyecto %}
        <p><strong>Proyecto asignado:</strong> {{ resumen.proyecto }}</p>
      {% endif %}
      {% if resumen.institucion %}
        <p><strong>Institución:</strong> {{ resumen.institucion }}</p>
      {% endif %}

      {% if resumen.horario %}
        <h4>Horario</h4>
        <ul>
          {%- for dia, horas in resumen.horario.items() -%}
            <li>{{ dia|capitalize }}: {{ horas[0] }} - {{ horas[1] }}</li>
          {%- endfor -%}
        </ul>
      {% endif %}

      {% if resumen.comentarios %}
        <h4>Comentarios</h4>
        <ul>
          {%- for c in resumen.comentarios -%}
            <li>{{ c.fecha.strftime('%d/%m/%Y') }} — {{ c.usuario }}: {{ c.comentario }}</li>
          {%- endfor -%}
        </ul>
      {% endif %}
    {% endif %}

    {% if registros %}
      <hr>
      <h3>Historial de acciones</h3>
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Acción</th>
            <th>Usuario</th>
          </tr>
        </thead>
        <tbody>
          {% for r in registros %}
            <tr>
              <td>{{ r.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
              <td>{{ r.accion }}</td>
              <td>{{ r.usuario }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>
</main>
{% endblock %}